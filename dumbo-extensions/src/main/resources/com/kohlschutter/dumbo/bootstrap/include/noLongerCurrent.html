<div id="noLongerCurrentTopCallout"
	class="bs-callout bs-callout-danger hidden"
	style="margin-top: -50px; position: fixed; width: 100%; z-index: 10000">This
	window is no longer being updated.</div>
<div id="noLongerCurrentModal" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">This window is no longer being updated</h4>
			</div>
			<div class="modal-body">
				<p>The connection to the service has been terminated.</p>
			</div>
			<div class="modal-footer">
				<a href="#" class="modal-a-reloadpage"><button type="button"
						class="btn btn-default">Reload page</button></a><a href="#"
					class="modal-a-keepopen"><button type="button"
						class="btn btn-default">Keep it open</button></a> <a
					href="javascript:window.close()" class="modal-a-closewindow"><button
						type="button" class="btn btn-primary">Close Window</button></a>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
    Dumbo.whenLoaded(() => {
                        if (Dumbo && Dumbo.app && Dumbo.app.console) {
                            Dumbo.app.console.onClose = function() {
                                var callout = document.getElementById("noLongerCurrentTopCallout");

                                callout.classList.add("hidden");
                                document.body.classList.add('noLongerCurrent');
                                callout.classList.remove('bs-callout-danger');
                                callout.classList.add('bs-callout-info');
                                callout.innerText = "The connection to the service has been terminated. This window is no longer being updated.";

                                var modal = document.getElementById("noLongerCurrentModal");
                                if (modal) {
                                    var bsModal = new bootstrap.Modal(modal);

                                    var keepOpen = () => {
                                        document.body.classList.add('noLongerCurrent');
                                        document.getElementById('noLongerCurrentTopCallout').classList.remove('hidden');
                                        bsModal.hide();
                                    };

                                    modal.querySelector(".modal-a-reloadpage").onclick = () => { location.reload(); };
                                    modal.querySelector(".modal-a-keepopen").onclick = keepOpen;
                                    modal.querySelector(".modal-a-closewindow").onclick = () => { setTimeout(() => { window.close(); }, 0); keepOpen(); };

                                    bsModal.show();
                                } else {
                                    callout.classList.remove('hidden');
                                }
                            };
                        }
                    });
</script>
